all: init smolsh

# Remove any builtin targets...
.SUFFIXES:

# Make sure we know where to get nolibc
ifndef NOLIBCDIR
$(error Please pass NOLIBCDIR with the path to your copy of nolibc (tools/include/nolibc/ in the linux source))
endif

# Make sure we know where the toolchain is
ifndef CROSS_COMPILE
$(error Please pass CROSS_COMPILE with the prefix of you toolchain)
endif

CC=$(CROSS_COMPILE)gcc
BFDLD=$(CROSS_COMPILE)ld.bfd
STRIP=$(CROSS_COMPILE)strip

COPTS=-m68000 \
	-g \
	-nostdlib \
	-std=c99 \
	-flto \
	-Os

%.o: %.c
	$(CC) $(COPTS) \
	 -include $(NOLIBCDIR)/nolibc.h \
	 -c -o $@ $<

init: init.o
	$(CC) $(COPTS) $^ -o $@

smolsh: smolsh.o
	$(CC) $(COPTS) $^ -o $@

.PHONY: clean
clean:
	rm -f init smolsh *.o *.gdb
